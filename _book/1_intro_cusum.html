<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MATH337: Changepoint Detection - 1&nbsp; An Introduction to Changepoint Detection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./2_control.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./1_intro_cusum.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An Introduction to Changepoint Detection</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MATH337: Changepoint Detection</a> 
        <div class="sidebar-tools-main">
    <a href="./MATH337--Changepoint-Detection.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_intro_cusum.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An Introduction to Changepoint Detection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Controlling the CUSUM and Other Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_multiple_changes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Multiple changepoints</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_algos_and_penalties.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">PELT, WBS and Penalty choices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_real_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with Real Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-to-time-series" id="toc-introduction-to-time-series" class="nav-link active" data-scroll-target="#introduction-to-time-series"><span class="header-section-number">1.1</span> Introduction to Time Series</a>
  <ul class="collapse">
  <li><a href="#what-is-a-time-series" id="toc-what-is-a-time-series" class="nav-link" data-scroll-target="#what-is-a-time-series"><span class="header-section-number">1.1.1</span> What is a time series?</a></li>
  <li><a href="#properties-of-time-series" id="toc-properties-of-time-series" class="nav-link" data-scroll-target="#properties-of-time-series"><span class="header-section-number">1.1.2</span> Properties of time series</a></li>
  </ul></li>
  <li><a href="#introduction-to-changepoints" id="toc-introduction-to-changepoints" class="nav-link" data-scroll-target="#introduction-to-changepoints"><span class="header-section-number">1.2</span> Introduction to changepoints</a>
  <ul class="collapse">
  <li><a href="#types-of-changes-in-time-series" id="toc-types-of-changes-in-time-series" class="nav-link" data-scroll-target="#types-of-changes-in-time-series"><span class="header-section-number">1.2.1</span> Types of Changes in Time Series</a></li>
  <li><a href="#the-biggest-data-challenge-in-changepoint-detection" id="toc-the-biggest-data-challenge-in-changepoint-detection" class="nav-link" data-scroll-target="#the-biggest-data-challenge-in-changepoint-detection"><span class="header-section-number">1.2.2</span> The biggest data challenge in changepoint detection</a></li>
  </ul></li>
  <li><a href="#detecting-one-change-in-mean" id="toc-detecting-one-change-in-mean" class="nav-link" data-scroll-target="#detecting-one-change-in-mean"><span class="header-section-number">1.3</span> Detecting one change in mean</a>
  <ul class="collapse">
  <li><a href="#the-cusum-statistics" id="toc-the-cusum-statistics" class="nav-link" data-scroll-target="#the-cusum-statistics"><span class="header-section-number">1.3.1</span> The CUSUM statistics</a></li>
  <li><a href="#searching-for-all-taus" id="toc-searching-for-all-taus" class="nav-link" data-scroll-target="#searching-for-all-taus"><span class="header-section-number">1.3.2</span> Searching for all <span class="math inline">\(\tau\)</span>s</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">1.3.3</span> Example</a></li>
  <li><a href="#sec-algorithmic-formulation-of-the-cusum-statistic" id="toc-sec-algorithmic-formulation-of-the-cusum-statistic" class="nav-link" data-scroll-target="#sec-algorithmic-formulation-of-the-cusum-statistic"><span class="header-section-number">1.3.4</span> Algorithmic Formulation of the CUSUM Statistic</a></li>
  <li><a href="#example-a-large-sequence" id="toc-example-a-large-sequence" class="nav-link" data-scroll-target="#example-a-large-sequence"><span class="header-section-number">1.3.5</span> Example: a large sequence</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">1.4</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#workshop-1" id="toc-workshop-1" class="nav-link" data-scroll-target="#workshop-1"><span class="header-section-number">1.4.1</span> Workshop 1</a></li>
  <li><a href="#lab-1" id="toc-lab-1" class="nav-link" data-scroll-target="#lab-1"><span class="header-section-number">1.4.2</span> Lab 1</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An Introduction to Changepoint Detection</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction-to-time-series" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="introduction-to-time-series"><span class="header-section-number">1.1</span> Introduction to Time Series</h2>
<p>In this module, we will be dealing with <strong>time series</strong>. A time series is a sequence of observations recorded over time (or space), where the order of the data points is crucial.</p>
<section id="what-is-a-time-series" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="what-is-a-time-series"><span class="header-section-number">1.1.1</span> What is a time series?</h3>
<p>In previous modules, such as Likelihood Inference, we typically dealt with data that was not ordered in a particular way. For example, we might have worked with a sample of independent Gaussian observations, where each observation is drawn randomly from the same distribution. This sample might look like the following:</p>
<p><span class="math display">\[
  y_i \sim \mathcal{N}(0,1), \ i = 1, \dots, 100
\]</span></p>
<p>Here, <span class="math inline">\(y_i\)</span> represents the <span class="math inline">\(i\)</span>-th observation, and the assumption is that all observations are independent and identically distributed (i.i.d.) with a mean of 0 and variance of 1.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this case, the observations do not have any particular order, and our primary interest may be in estimating parameters such as the mean, variance, or mode of the distribution. This is typical for traditional inference, where the order of observations is not of concern.</p>
<p>However, a <strong>time series</strong> involves a specific order to the data—usually indexed by time, although it could also be by space or another sequential dimension. For example, we could assume that the Gaussian sample above is a sequential process, ordered by the time we drew an observation. Each observation corresponds to a specific time point <span class="math inline">\(t\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Formal Notation.</strong> In time series analysis, use an index <span class="math inline">\(t\)</span> to represent time or order on a given set of observations. The time series vector is written as:</p>
<p><span class="math display">\[
  y_{1:n} = (y_1, y_2, \dots, y_n).
\]</span></p>
<p>Here, <span class="math inline">\(n\)</span> is the total length of the sequence, and <span class="math inline">\(y_t\)</span> represents the observed value at time <span class="math inline">\(t\)</span>, for <span class="math inline">\(t = 1, 2, \dots, n\)</span>. In our previous example, for instance, <span class="math inline">\(n = 100\)</span>.</p>
<p>Often, we are also interested in subsets of a time series, especially when investigating specific “windows” or “chunks” of the data. A subset of a time series, starting from time <span class="math inline">\(l\)</span> to time <span class="math inline">\(u\)</span>, with <span class="math inline">\(l \leq u\)</span>, will be denoted by the following:</p>
<p><span class="math display">\[
  y_{l:u} = (y_l, y_{l+1}, \dots, y_u),
\]</span></p>
<p>Where if <span class="math inline">\(l = u\)</span>, <span class="math inline">\(y_{l:l} = (y_l)\)</span>.</p>
</section>
<section id="properties-of-time-series" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="properties-of-time-series"><span class="header-section-number">1.1.2</span> Properties of time series</h3>
<p>Time series can have various statistical properties that explain how they behave over time, and they can be characterized based on those. Let us look at three examples of time series:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="A">
<li><p>The leftmost time series, was generated by sampling random normal variables <span class="math inline">\(y_t = \epsilon_t, \ \epsilon_t \sim \mathcal{N}(0, 1)\)</span>. In this case: <span class="math display">\[
    \mathbb{E}(y_t) = \mathbb{E}(\epsilon_t) = 0, \ \text{Var}(y_t) = \text{Var}(\epsilon_t) = 1, \ \forall \  t \in \{1, ..., 100\}.
\]</span><br>
Say we generate more observations under the same random process, this will give us still a value that will be centered on 0, with variance 1, e.g.&nbsp;<span class="math inline">\(\mathbb{E}(y_{150}) = 0, \ \text{Var}(y_{150}) = 1\)</span>.<br>
</p></li>
<li><p>In the centre time series, the series is generated as: <span class="math display">\[
    y_t = \epsilon_t + 0.1 \cdot t , \ \epsilon_t \sim \mathcal{N}(0, 1).
\]</span>This creates a time series with a linear upward trend. Similarly to what done before: <span class="math display">\[
    \mathbb{E}(y_t) = \mathbb{E}(\epsilon_t) + \mathbb{E}(0.1 \cdot t) = 0.1 \cdot t.
\]</span></p>
<p>Again, saying that we wish to predict the behaviour of the time series at time 150, we know this will be centered on <span class="math inline">\(\mathbb{E}(y_{150}) = 1.5\)</span> (and with which variance?).</p></li>
<li><p>In the rightmost example, the time series was generated for the first half of the observations as in A., however after <span class="math inline">\(t = 50\)</span>, a sudden shift occurs. Mathematically: <span class="math display">\[
y_t = \begin{cases}
    \epsilon_t &amp; \text{for } t \leq 50 \\
    \epsilon_t + 5 &amp; \text{for } t &gt; 50
    \end{cases}, \quad \epsilon_t \sim \mathcal{N}(0, 1)
\]</span> This abrupt change at <span class="math inline">\(t = 50\)</span> introduces a piecewise structure to the data, where the data is seen following a distribution prior to the change, <span class="math inline">\(y_t \sim N(0, 1)\)</span> up to a certain time point <span class="math inline">\(t=50\)</span>, and <span class="math inline">\(y_t \sim N(5, 1)\)</span> after. In many examples of this module, we will be studying processes that are piecewise stationary in the mean and variance, as in this example.</p></li>
</ol>
<p><strong>Stationarity in the mean and variance.</strong> A time series is said to be <em>stationary</em> in mean and variance, if its mean and variance are constant over time. That is, for a time series <span class="math inline">\(y_{1:n}\)</span>: <span class="math display">\[
    \mathbb{E}(y_t) = \mu \quad \text{and} \quad \text{Var}(y_t) = \sigma^2 \quad \forall \in \{1, ..., n\}
\]</span></p>
<p>Similarly, a time series is <em>non-stationary</em> in the mean and variance if those change over time.</p>
<p><strong>Piecewise stationary in the mean and variance.</strong> A <em>piecewise stationary</em> time series is a special case of a non-stationary time series. We will say that a time series is <em>piecewise stationary</em> in mean and variance if it is stationary within certain segments but has changes in the mean or variance at certain points, known as <em>changepoints</em>. After each changepoint, the series may have a different mean, variance, or both.</p>
<p><em>Back to our example.</em></p>
<ul>
<li><p>In A., we can see, very simply how, in this case <span class="math display">\[
    \mathbb{E}(y_t) = \mathbb{E}(\epsilon_t) = 0, \forall t \in \{1, ..., 100\},
\]</span>therefore our series is stationary in the mean and variance.</p></li>
<li><p>In B, we notice that: <span class="math display">\[
  \forall t_1, t_2 \in \{1, ..., 100\}, t_1 \neq t_2 \rightarrow \mathbb{E}(y_{t_1}) \neq \mathbb{E}(y_{t_2}).
\]</span><br>
We can therefore say that the series is non-stationary in the mean.</p></li>
<li><p>In C, <span class="math inline">\(E[y_t] = E[\epsilon_t] = 0\)</span> for <span class="math inline">\(t \leq 50\)</span>, and <span class="math inline">\(E[y_t] = E[\epsilon_t] + E[3] = 5\)</span> for <span class="math inline">\(t &gt; 50\)</span>. The series is therefore piecewise stationary in the mean.</p></li>
</ul>
</section>
</section>
<section id="introduction-to-changepoints" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="introduction-to-changepoints"><span class="header-section-number">1.2</span> Introduction to changepoints</h2>
<p>Changepoints are sudden, and often unexpected, shifts in the behavior of a process. They are also known as breakpoints, structural breaks, or regime switches. The detection of changepoints is crucial in understanding and responding to changes in various types of time series data.</p>
<p>The primary objectives in detecting changepoints include:</p>
<ul>
<li><strong>Has a change occurred?</strong>: Identifying if there is a shift in the data.</li>
<li><strong>If yes, where is the change?</strong>: Locating the precise point where the change happened.</li>
<li><strong>What is the difference between the pre and post-change data?</strong> This may reveal the type of change, and it helps to reconstruct the piece-wise constant signal.</li>
<li><strong>How certain are we of the changepoint location?</strong>: Assessing the confidence in the detected changepoint.</li>
<li><strong>How many changes have occurred?</strong>: Identifying multiple changepoints, and as above, their locations, segment-wise parameters, etc</li>
</ul>
<p>Changepoints can be found in a wide range of time series, not limited to physical, biological, industrial, or financial processes, and which objectives to follow depends on the type of the analysis we are carrying.</p>
<p>In changepoint detection, there are two main approaches: <strong>online</strong> and <strong>offline</strong> analysis. In applications that require <strong>online analysis</strong>, the data is processed as it arrives, or in small batches. The primary goal of online changepoint detection is to identify changes as quickly as possible, making it crucial in contexts such as process control or intrusion detection, where immediate action is necessary.</p>
<p>On the other hand, <strong>offline analysis</strong> processes all the data at once, typically after it has been fully collected. The aim here is to provide an accurate detection of changepoints, rather than a rapid one. This approach is common in fields like biology, medicine, genomics, physics, where the focus is on understanding the structure of the data post-collection, and the change locations are key objects of interest.</p>
<p>To give few examples:</p>
<ol type="1">
<li><p><strong>Spectroscopy data.</strong> Changepoint detection is useful in spectroscopy data to segment time series of electron emissions into regions of approximately constant intensity, accounting for large-scale fluctuations in laser power and beam pointing.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source_imgs/photon_emission.png" class="img-fluid figure-img"></p>
<figcaption>Electron emission spectroscopy data, Frick, K., Munk, A., &amp; Sieling, H. (2014).</figcaption>
</figure>
</div></li>
<li><p><strong>ECG</strong>: Detecting changes or abnormalities in electrocardiogram (ECG) data can help in diagnosing heart conditions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source_imgs/intro-ecg.png" class="img-fluid figure-img"></p>
<figcaption>Electrocardiograms (heart monitoring), Fotoohinasab et al, Asilomar conference 2020.</figcaption>
</figure>
</div></li>
<li><p><strong>Cancer Diagnosis</strong>: Identifying breakpoints in DNA copy number data is important for diagnosing some types of cancer, such as neuroblastoma. This is a typical example of an offline analysis.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source_imgs/intro-breakpoints.png" class="img-fluid figure-img"></p>
<figcaption>DNA copy number data, breakpoints associated with aggressive cancer, Hocking et al, Bioinformatics 2014.</figcaption>
</figure>
</div></li>
<li><p><strong>Engineering Monitoring</strong>: Detecting changes in CPU monitoring data in servers can help in identifying potential issues or failures: this is often analysed in real-time on with online methods, with the aim of detecting an issue as quickly as possible.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="source_imgs/CPU-monitoring.png" class="img-fluid figure-img"></p>
<figcaption>Temperature data from a CPU of an AWS server. Source Romano et al., (2023)</figcaption>
</figure>
</div></li>
<li><p><strong>Gamma Ray-Burst detection.</strong> Efficient online changepoint detection algorithms can detect gamma-ray bursts from gamma-ray counts on satellites in space. These bursts events happen in just a fraction of a second, and are related to supernova implosions.<br>
<br>
<img src="source_imgs/gamma_ray_burst.jpg" class="img-fluid" alt="Gamma-ray counts over time, with a gamma-ray burst highligted in red. Source Ward &amp; al.&nbsp;(2024)"></p></li>
</ol>
<p>In this module, we will focus exclusively on <strong>offline</strong> changepoint detection, where we assume that all the data is available for analysis from the start.</p>
<section id="types-of-changes-in-time-series" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="types-of-changes-in-time-series"><span class="header-section-number">1.2.1</span> Types of Changes in Time Series</h3>
<p>Depending on the model, we could seek for different types of changes in the structure of a time series. Some of the most common types of changes include shifts in mean, variance, and trends in regression. For example, the CPU example above exihibited, in addition to some extreme observations, both changes in mean and variance.</p>
<ul>
<li>A <strong>change in mean</strong> occurs when the average level of an otherwise stationary time series shifts from one point to another.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the plot above, the red lines indicate the true mean values of the different segments.</p>
<ul>
<li>A <strong>change in variance</strong> refers to a shift in the variability of the time series data, even when the mean remains constant.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="change-in-regression-slope" class="level4" data-number="1.2.1.1">
<h4 data-number="1.2.1.1" class="anchored" data-anchor-id="change-in-regression-slope"><span class="header-section-number">1.2.1.1</span> 3. Change in Regression (Slope)</h4>
<p>A <strong>change in regression</strong> or slope occurs when the underlying relationship between time, and/or other auxiliary variables, and the values of the time series changes.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-biggest-data-challenge-in-changepoint-detection" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="the-biggest-data-challenge-in-changepoint-detection"><span class="header-section-number">1.2.2</span> The biggest data challenge in changepoint detection</h3>
<p>One of the most widely debated and difficult data challenges in changepoint detection may not be in the field of finance, genetics, or climate science—but rather in television history. Specifically, the question that has plagued critics and fans alike for years is: <strong>At which episode did “The Simpsons” start to decline?</strong></p>
<p>It’s almost common knowledge that “The Simpsons,” the longest-running and most beloved animated sitcom, experienced a significant drop in quality over time. But pinpointing exactly <em>when</em> this drop occurred is the real challenge. Fortunately, there’s a branch of statistics that was practically built to answer questions like these!</p>
<p>I have downloaded a dataset <span class="citation" data-cites="bown_simpsons_dataset">(<a href="references.html#ref-bown_simpsons_dataset" role="doc-biblioref">Bown 2023</a>)</span> containing ratings for every episode of “The Simpsons” up to season 34. We will analyze this data to determine if and when a significant shift occurred in the ratings, which might reflect the decline in quality that so many have observed.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this plot, each episode of “The Simpsons” is represented by its TMBD rating, and episodes are colored by season. By visually inspecting the graph, we may already start to see some potential points where the ratings decline. However, the goal of our changepoint analysis is to move beyond visual inspection and rigorously detect the exact moment where a significant shift in the data occurs.</p>
<p>Jokes apart, this is a challenging time series! First of all, there’s not a clear single change, but rather an increase, followed by a decline. After which, the sequence seems rather stationary. For this reason, throughout the module, we will use this data as a running example to develop our understanding of various methods, hopefully trying to obtain a definitive answer towards the final chapters. But let’s proceed with order…</p>
</section>
</section>
<section id="detecting-one-change-in-mean" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="detecting-one-change-in-mean"><span class="header-section-number">1.3</span> Detecting one change in mean</h2>
<p>In this section, we will start by exploring the simplest case of a changepoint detection problem: <strong>detecting a change in the mean</strong> of a time series. We assume that the data is generated according to the following model:</p>
<p><span class="math display">\[
y_t = \mu_t + \epsilon_t, \quad t = 1, \dots, n,
\]</span></p>
<p>where <span class="math inline">\(\epsilon_t \sim \mathcal{N}(0, \sigma^2)\)</span> represents Gaussian noise with mean 0 and known variance <span class="math inline">\(\sigma^2\)</span>, and <span class="math inline">\(\mu_t \in \mathbb{R}\)</span> is the signal at time <span class="math inline">\(t\)</span>, with <span class="math inline">\(\mathbb{E}(y_t) = \mu_t\)</span>. The vector of noise terms <span class="math inline">\(\epsilon_{1:n}\)</span> is often referred to as Gaussian noise, and hence, this model is known as <em>the signal plus noise model</em>, where the signal is given by <span class="math inline">\(\mu_{1:n}\)</span> and the noise by <span class="math inline">\(\epsilon_{1:n}\)</span>.</p>
<p>In <em>the single change-in-mean problem</em>, our goal is to determine whether the signal remains constant throughout the entire sequence, or if there exists a point <span class="math inline">\(\tau\)</span>, where the mean shifts. In other words, we are testing whether</p>
<p><span class="math display">\[
\mu_1 = \mu_2 = \dots = \mu_n \quad \text{(no changepoint)},
\]</span></p>
<p>or if there exists a time <span class="math inline">\(\tau\)</span> such that</p>
<p><span class="math display">\[
\mu_1 = \mu_2 = \dots = \mu_\tau \neq \mu_{\tau+1} = \dots = \mu_n \quad \text{(changepoint at } \tau\text{)}.
\]</span></p>
<p><strong>Note.</strong> The point <span class="math inline">\(\tau\)</span> is our <em>changepoint</em>, e.g.&nbsp;the last point after which our mean changes, however there’s a lot of inconsistencies on the literature: sometimes you will find that people refer to <span class="math inline">\(\tau + 1\)</span> as the changepoint, and <span class="math inline">\(\tau\)</span> as the last pre-change point (as a matter of fact, please let me know if you spot this inconsistency anywhere in these notes!).</p>
<p>To address this problem, one of the most widely used methods is <em>the CUSUM (Cumulative Sum) statistic</em>. The basic idea behind the CUSUM statistic is to systematically compare the mean of the data to the left and right of each possible changepoint <span class="math inline">\(\tau\)</span>. By doing so, we can assess whether there is evidence of a significant change in the mean at a given point.</p>
<section id="the-cusum-statistics" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="the-cusum-statistics"><span class="header-section-number">1.3.1</span> The CUSUM statistics</h3>
<p>We compare, for a fixed <span class="math inline">\(\tau \in \{1, \dots, n-1\}\)</span> , the empirical mean (average) of the data to the left (before <span class="math inline">\(\tau\)</span>) with the empirical mean of the data to the right (after <span class="math inline">\(\tau\)</span>):</p>
<p><span class="math display">\[
C_{\tau} = \sqrt{\frac{\tau(n-\tau)}{n}} \left| \bar{y}_{1:\tau} - \bar{y}_{(\tau+1):n} \right|,
\]</span></p>
<p>Our <span class="math inline">\(\bar{y}_{1:\tau}\)</span> and <span class="math inline">\(\bar{y}_{(\tau+1):n}\)</span> are just the empirical means of each segment, simply computed with:</p>
<p><span class="math display">\[
\bar{y}_{l:u} = \frac{1}{u - l + 1} \sum_{t = l}^{u} y_t.
\]</span></p>
<p>The term on the left of the difference, is there to re-scale it so that our statistics is the absolute value of normal random variable that has variance <span class="math inline">\(\sigma^2\)</span>. If there is no change at <span class="math inline">\(\tau\)</span>, this difference is going to be distributed as a standard normal.</p>
<p>This approach is intuitive because if the mean <span class="math inline">\(\mu\)</span> is the same across the entire sequence, the values of the averages on both sides of any point <span class="math inline">\(\tau\)</span> should be similar. However, if there is a large-enough change in the mean, the means will differ significantly, highlighting the changepoint.</p>
<p>More formally, we declare a change at <span class="math inline">\(\tau\)</span> if:</p>
<p><span class="math display">\[
\frac{C_{\tau}^2 }{\sigma^2} &gt; c_\tau,
\]</span> where the <span class="math inline">\(c_\tau \in \mathbb{R}^+\)</span> is a suitable chosen threshold value (in fact it is often chosen as in hypothesis testing). The <span class="math inline">\(\frac{C_{\tau}^2 }{\sigma^2}\)</span> is known as the CUSUM statistics for a fixed change at <span class="math inline">\(\tau\)</span>.</p>
</section>
<section id="searching-for-all-taus" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="searching-for-all-taus"><span class="header-section-number">1.3.2</span> Searching for all <span class="math inline">\(\tau\)</span>s</h3>
<p>In practice, however, we do not know the changepoint location in advance. Our goal is to detect whether a changepoint exists and, if so, estimate its location. To achieve this, we need to consider all possible changepoint locations and choose the one that maximizes our test statistic.</p>
<p>The natural solution to this situation is to use as a test statistic the maximum of <span class="math inline">\(C_\tau\)</span> as we vary <span class="math inline">\(\tau\)</span>:</p>
<p><span class="math display">\[
C^2_{max} = \max_{\tau \in \{1,\ldots,n-1\}} C_\tau^2 / \sigma^2.
\]</span></p>
<p>And detect a changepoint if <span class="math inline">\(C^2_{max} &gt; c\)</span> for some suitably chosen threshold <span class="math inline">\(c \in \mathbb{R}^+\)</span>. The choice of <span class="math inline">\(c\)</span> will determine the significance level of the test (we’ll discuss this in more detail later). Graphically, the test will look as follows:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we detect a changepoint (i.e., if <span class="math inline">\(C^2_{max} &gt; c\)</span>), we can estimate its location by:</p>
<p><span class="math display">\[
\hat{\tau} = \arg\max_{\tau \in \{1,\ldots,n-1\}}  C_\tau^2.
\]</span></p>
<p>In other words, <span class="math inline">\(\hat{\tau}\)</span> is the value of <span class="math inline">\(\tau\)</span> that maximizes the CUSUM statistic.</p>
<p>A simple estimate of the size of the change is then given by:</p>
<p><span class="math display">\[
\Delta\hat{\mu} = \bar{y}_{(\hat{\tau}+1):n} - \bar{y}_{1:\hat{\tau}}.
\]</span></p>
<p>This estimate represents the difference between the mean of the data after the estimated changepoint and the mean of the data before the estimated changepoint.</p>
</section>
<section id="example" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="example"><span class="header-section-number">1.3.3</span> Example</h3>
<p>Let us compute the cusum for the vector <span class="math inline">\(y_{1:4} = (0.5, -0.1, 12.1, 12.4)\)</span>, assuming known <span class="math inline">\(\sigma^2 = 1\)</span> variance.</p>
<p>We know that <span class="math inline">\(n = 4\)</span> (the total number of observations), therefore possible changepoints are: <span class="math inline">\(\tau = 1, 2, 3\)</span>.</p>
<p><strong>Compute empirical means for each segment</strong></p>
<p>We first need to calculate the segment means, <span class="math inline">\(\bar{y}_{1:\tau}\)</span> and <span class="math inline">\(\bar{y}_{(\tau+1):n}\)</span>, for each <span class="math inline">\(\tau\)</span>.</p>
<ul>
<li><p>For <span class="math inline">\(\tau = 1\)</span>, the left segment is: <span class="math inline">\(y_{1:1} = (0.5)\)</span>, and <span class="math inline">\(\bar{y}_{1:1} = 0.5.\)</span> The right segment: <span class="math inline">\(y_{2:4} = (-0.1, 12.1, 12.4)\)</span> gives <span class="math inline">\(\bar{y}_{2:4} = \frac{-0.1 + 12.1 + 12.4}{3} = \frac{24.4}{3} = 8.13.\)</span></p></li>
<li><p>For <span class="math inline">\(\tau = 2\)</span>, we have, in a similar fashion, <span class="math inline">\(\bar{y}_{1:2} = \frac{0.5 - 0.1}{2} = 0.2\)</span>, <span class="math inline">\(\bar{y}_{3:4} = \frac{12.1 + 12.4}{2} = 12.25\)</span>,</p></li>
<li><p>Lastly, for <span class="math inline">\(\tau = 3\)</span>, we have <span class="math inline">\(\bar{y}_{1:3} = \frac{0.5 - 0.1 + 12.1}{3} = \frac{12.5}{3} = 4.16\)</span> and <span class="math inline">\(\bar{y}_{4:4} = 12.4\)</span>.</p></li>
</ul>
<p><strong>Compute the CUSUM statistics</strong></p>
<p>Now that we have the empirical means for each segment, we have all the ingredients for computing our CUSUM:</p>
<p><span class="math display">\[
C_{\tau} = \sqrt{\frac{\tau(n-\tau)}{n}} \left| \bar{y}_{1:\tau} - \bar{y}_{(\tau+1):n} \right|.
\]</span></p>
<ul>
<li><p><strong>For</strong> <span class="math inline">\(\tau = 1\)</span>: <span class="math display">\[
C_1 = \sqrt{\frac{1(4-1)}{4}} \left| 0.5 - 8.13\overline{3} \right| = 0.866 \times 7.63\overline{3} = 6.61.
\]</span></p></li>
<li><p><strong>For</strong> <span class="math inline">\(\tau = 2\)</span>: <span class="math display">\[
C_2 = \sqrt{\frac{2(4-2)}{4}} \left| 0.2 - 12.25 \right| = 1 \times 12.05 = 12.05.
\]</span></p></li>
<li><p><strong>For</strong> <span class="math inline">\(\tau = 3\)</span>: <span class="math display">\[
C_3 = \sqrt{\frac{3(4-3)}{4}} \left| 4.16\overline{6} - 12.4 \right| = 0.866 \times 8.23\overline{3} = 7.13.
\]</span></p></li>
</ul>
<p>Thus, the maximum of the CUSUM statistic occurs at <span class="math inline">\(\tau = 2\)</span>, with <span class="math inline">\(C_{max} = 12.05\)</span>. To detect a changepoint, we would compare <span class="math inline">\(C_{max}\)</span> to a threshold value <span class="math inline">\(c\)</span>. If <span class="math inline">\(C_{max}^2 = 145.20 \geq c\)</span>, we conclude that there is a changepoint at <span class="math inline">\(\hat{\tau} = 2\)</span>.</p>
</section>
<section id="sec-algorithmic-formulation-of-the-cusum-statistic" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="sec-algorithmic-formulation-of-the-cusum-statistic"><span class="header-section-number">1.3.4</span> Algorithmic Formulation of the CUSUM Statistic</h3>
<p>This process seems rather long, as for every step, we need to precompute the means… A naive implementation of the cusum, in fact, takes <span class="math inline">\(\mathcal{O}(n^2)\)</span> computations.</p>
<p>However, there’s an algorithmic trick: by sequentially computing partial sums, e.g.&nbsp;<span class="math inline">\(S_n = \sum_{i=1}^n y_i\)</span>, we can shorten out our computations significantly. In this way we can compute the value of the means directly as we iterate in the for cycle.</p>
<hr>
<div class="line-block"><strong>INPUT:</strong> Time series <span class="math inline">\(y = (y_1, ..., y_n)\)</span>, threshold <span class="math inline">\(c\)</span>, variance <span class="math inline">\(\sigma^2\)</span>.<br>
<strong>OUTPUT:</strong> Changepoint estimate <span class="math inline">\(\hat{\tau}\)</span>, maximum CUSUM statistic <span class="math inline">\(C_{max}\)</span><br>
<br>
<span class="math inline">\(n \leftarrow\)</span> length of <span class="math inline">\(y\)</span><br>
<span class="math inline">\(C_{max} \leftarrow 0\)</span><br>
<span class="math inline">\(\hat{\tau} \leftarrow 0\)</span><br>
<span class="math inline">\(S_n \leftarrow \sum_{i=1}^n y_i\)</span> // Compute total sum of y<br>
<span class="math inline">\(S \leftarrow 0\)</span><br>
<br>
<strong>FOR</strong> <span class="math inline">\(t = 1, \dots, n - 1\)</span><br>
&nbsp;&nbsp;<span class="math inline">\(S \leftarrow S + y_t\)</span><br>
&nbsp;&nbsp;<span class="math inline">\(\bar{y}_{1:t} \leftarrow S / t\)</span><br>
&nbsp;&nbsp;<span class="math inline">\(\bar{y}_{(t+1):n} \leftarrow (S_n - S) / (n - t)\)</span> // Can you figure out why?<br>
&nbsp;&nbsp;<span class="math inline">\(C^2_t \leftarrow \frac{t(n-t)}{n} (\bar{y}_{1:t} - \bar{y}_{(t+1):n})^2\)</span><br>
&nbsp;&nbsp;<strong>IF</strong> <span class="math inline">\(C^2_t &gt; C_{max}\)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="math inline">\(C_{max} \leftarrow C_t^2\)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="math inline">\(\hat{\tau} \leftarrow t\)</span><br>
<br>
<strong>IF</strong> <span class="math inline">\(C_{max} / \sigma^2 &gt; c\)</span><br>
&nbsp;&nbsp;<strong>RETURN</strong> <span class="math inline">\(\hat{\tau}\)</span>, <span class="math inline">\(C_{max}\)</span> // Changepoint detected<br>
<strong>ELSE</strong><br>
&nbsp;&nbsp;<strong>RETURN</strong> NULL, <span class="math inline">\(C_{max}\)</span> // No changepoint detected</div>
<hr>
<p>For this reason, the time complexity of the CUSUM algorithm is <span class="math inline">\(O(n)\)</span>, where <span class="math inline">\(n\)</span> is the length of the time series.</p>
</section>
<section id="example-a-large-sequence" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="example-a-large-sequence"><span class="header-section-number">1.3.5</span> Example: a large sequence</h3>
<p>We can see how the value <span class="math inline">\(C^2_t\)</span> in the algorithm above behaves across different values of <span class="math inline">\(t = 1, \dots, n-1\)</span> in the example below:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Running the CUSUM test, and maximising on our Simpsons episode, results in:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_intro_cusum_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This results in episode Thirty Minutes over Tokyo being the last “good” Simpsons episode, with Beyond Blunderdome being the start of the decline, according to the Gaussian change-in-mean model!</p>
</section>
</section>
<section id="exercises" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="exercises"><span class="header-section-number">1.4</span> Exercises</h2>
<section id="workshop-1" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="workshop-1"><span class="header-section-number">1.4.1</span> Workshop 1</h3>
<ol type="1">
<li><p>Determine if the following processes are stationary, piecewise stationary, or non-stationary:</p>
<ol type="a">
<li><p><span class="math inline">\(y_t = y_{t - 1} + \epsilon_t, \quad \ t = 2, \dots, n, y_1 = 0, \epsilon_{t} \sim N(0, 1)\)</span>. This is a random walk model. Let’s start by computing the expected value and variance of <span class="math inline">\(y_t\)</span> across all <span class="math inline">\(t\)</span>. <strong>TIP:</strong> Start by expanding <span class="math inline">\(y_{t}\)</span> in terms of the noise components…</p></li>
<li><p><span class="math inline">\(y_t = t \epsilon_t + 3 \mathbb{1}(t &gt; 50), \quad t = 1, \dots, 100, \quad \epsilon_{t} \sim N(0, 1)\)</span></p></li>
<li><p><span class="math inline">\(y_t = 0.05 \cdot t + \epsilon_t, \ t = 1, \dots, 100, \quad \epsilon_{t} \sim N(0, 1)\)</span></p></li>
</ol></li>
<li><p>For an i.i.d. Gaussian time series <span class="math inline">\(y = (y_1, ..., y_n)\)</span> with known variance <span class="math inline">\(\sigma^2\)</span>, and fixed and known change at <span class="math inline">\(\tau \in \{1, \dots, n-1\}\)</span>, with <span class="math inline">\(\, n \in \mathbb{N}, \,  n &gt; \tau\)</span>, show that: <span class="math display">\[ \frac{1}{\sigma}\sqrt{\frac{\tau(n-\tau)}{n}} ( \bar{y}_{1:\tau} - \bar{y}_{(\tau+1):n}) \]</span> in case of no change, e.g.&nbsp;for <span class="math inline">\(\mu_1 = \mu_2 = \dots = \mu_n = \mu\)</span>, follows a standard normal distribution. <strong>Hint:</strong></p>
<ol type="a">
<li><p>Compute the expected value and variance of the difference <span class="math inline">\(\bar{y}_{1:\tau} - \bar{y}_{(\tau+1):n}\)</span></p></li>
<li><p>Conclude that if you standardise the sum, this follows a standard normal distribution.</p></li>
</ol></li>
</ol>
</section>
<section id="lab-1" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="lab-1"><span class="header-section-number">1.4.2</span> Lab 1</h3>
<ol type="1">
<li><p>Code the CUSUM algorithm for a unknown change location, based on the pseudocode of Section <a href="#sec-algorithmic-formulation-of-the-cusum-statistic" class="quarto-xref"><span>Section 1.3.4</span></a>.</p></li>
<li><p>Modify your function above to output the CUSUM statistics over all ranges of tau.</p></li>
<li><p>Recreate the “CUSUM Statistics over time” plot for the Simpsons data above.</p></li>
</ol>
<!-- -->
<ol type="a">
<li>You’ll be able to load the dataset via:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>simpsons_episodes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://www.lancaster.ac.uk/~romano/teaching/2425MATH337/datasets/simpsons_episodes.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>simpsons_ratings <span class="ot">&lt;-</span> simpsons_episodes <span class="sc">|&gt;</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Episode =</span> id <span class="sc">+</span> <span class="dv">1</span>, <span class="at">Season =</span> <span class="fu">as.factor</span>(season), <span class="at">Rating =</span> tmdb_rating)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>simpsons_ratings <span class="ot">&lt;-</span> simpsons_ratings[<span class="sc">-</span><span class="fu">nrow</span>(simpsons_ratings), ]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># run your CUSUM algorithm on the Rating variable!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="a">
<li><p>To run it on the whole sequence, you’ll have to set the threshold <span class="math inline">\(c = \infty\)</span>.</p></li>
<li><p>Assume <span class="math inline">\(\sigma^2 = 1\)</span></p></li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bown_simpsons_dataset" class="csl-entry" role="listitem">
Bown, Jonathan. 2023. <span>“Simpsons Episodes &amp; Ratings (1989-Present).”</span> <a href="https://www.kaggle.com/datasets/jonbown/simpsons-episodes-2016?resource=download">https://www.kaggle.com/datasets/jonbown/simpsons-episodes-2016?resource=download</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="Preface">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./2_control.html" class="pagination-link" aria-label="Controlling the CUSUM and Other Models">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Controlling the CUSUM and Other Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>